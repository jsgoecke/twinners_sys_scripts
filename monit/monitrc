#Monit script for Twinners

set daemon  60
set logfile /var/log/monit.log
set alert ivr_alert@interactivechatsystems.com

set mailserver localhost
               with timeout 15 seconds

set httpd port 9111
  allow localhost

#check process alert_test with pidfile /root/alert_test/log/test.pid
#  start program = "/root/alert_test/bin/test start"
#  stop  program = "/root/alert_test/bin/test stop"

check process asterisk with pidfile /var/run/asterisk.pid
  group interactivechatsystems
  start program = "/usr/sbin/asterisk"
  stop program = "/usr/sbin/asterisk -rx 'stop now'"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }

check process stompserver with pidfile /var/run/interchatsystems/stompserver.pid
  group interactivechatsystems
  start program = "/usr/local/bin/ruby /etc/init.d/stompserver start"
  stop  program = "/usr/local/bin/ruby /etc/init.d/stompserver stop"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }

check process bls with pidfile /var/run/interactivechatsystems/twinners-core_twinners.pid
  group interactivechatsystems
  start program = "/usr/local/bin/ruby /etc/init.d/bls start"
  stop  program = "/usr/local/bin/ruby /etc/init.d/bls stop"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }

#check process avatar_gui with pidfile /var/run/avatar_gui.80.pid
#  group interactivechatsystems
#  start program = "/usr/local/bin/ruby /etc/init.d/avatar_gui start"
#  stop  program = "/usr/local/bin/ruby /etc/init.d/avatar_gui stop"
#  if cpu usage > 10% then alert
#  if mem usage > 20% then alert
#  if 5 restarts within 5 cycles then alert

check process stomptomanagerbridge with pidfile /var/run/interactivechatsystems/stomptomanagerbridge.pid
  group interactivechatsystems
  start program = "/usr/local/bin/ruby /etc/init.d/stomptomanagerbridge start"
  stop  program = "/usr/local/bin/ruby /etc/init.d/stomptomanagerbridge stop"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }

check process stomptoblsbridge with pidfile /var/run/interactivechatsystems/stomptblsbridge.pid
  group interactivechatsystems
  start program = "/usr/local/bin/ruby /etc/init.d/stomptoblsbridge start"
  stop  program = "/usr/local/bin/ruby /etc/init.d/stomptoblsbridge stop"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }

check process ahn with pidfile /var/run/adhearsion.pid
  group interactivechatsystems
  start program = "/usr/local/bin/ruby /etc/init.d/adhearsion start"
  stop  program = "/usr/local/bin/ruby /etc/init.d/adhearsion stop"
  if cpu usage > 10% then alert
  if mem usage > 20% then alert
  if 5 restarts within 5 cycles then alert
  alert ivr_alert@interactivechatsystems.com on { change checksum data exec gid icmp invalid
                                                  match nonexist permission size timeout timestamp }
